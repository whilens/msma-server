# üöÄ MSMA Server - Backend API

–°–µ—Ä–≤–µ—Ä–Ω–∞—è —á–∞—Å—Ç—å –ø–ª–∞—Ç—Ñ–æ—Ä–º—ã MSMA (Mixed Martial Arts) –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –±–æ—è–º–∏, –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º–∏ –∏ —á–∞—Ç–∞–º–∏.

## üìã –¢–µ—Ö–Ω–æ–ª–æ–≥–∏–∏

- **Node.js** + **Express.js** - –≤–µ–±-—Å–µ—Ä–≤–µ—Ä –∏ API
- **Sequelize ORM** - —Ä–∞–±–æ—Ç–∞ —Å –±–∞–∑–æ–π –¥–∞–Ω–Ω—ã—Ö
- **PostgreSQL** - –æ—Å–Ω–æ–≤–Ω–∞—è –±–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö
- **WebSocket** - —Ä–µ–∞–ª—å–Ω–æ–µ –≤—Ä–µ–º—è –¥–ª—è —á–∞—Ç–æ–≤
- **JWT** - –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è –∏ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è
- **PDFKit** - –≥–µ–Ω–µ—Ä–∞—Ü–∏—è PDF –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤
- **Multer** - –∑–∞–≥—Ä—É–∑–∫–∞ —Ñ–∞–π–ª–æ–≤
- **Joi** - –≤–∞–ª–∏–¥–∞—Ü–∏—è –¥–∞–Ω–Ω—ã—Ö

## üìÅ –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä–æ–µ–∫—Ç–∞

```
server/
‚îú‚îÄ‚îÄ index.js                 # –¢–æ—á–∫–∞ –≤—Ö–æ–¥–∞ —Å–µ—Ä–≤–µ—Ä–∞
‚îú‚îÄ‚îÄ websocket.js            # WebSocket —Å–µ—Ä–≤–µ—Ä
‚îú‚îÄ‚îÄ models/                 # –ú–æ–¥–µ–ª–∏ Sequelize
‚îÇ   ‚îú‚îÄ‚îÄ index.js           # –û—Å–Ω–æ–≤–Ω—ã–µ –º–æ–¥–µ–ª–∏ –∏ –∞—Å—Å–æ—Ü–∏–∞—Ü–∏–∏
‚îÇ   ‚îú‚îÄ‚îÄ users.js           # –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏
‚îÇ   ‚îú‚îÄ‚îÄ fighters.js        # –ë–æ–π—Ü—ã
‚îÇ   ‚îú‚îÄ‚îÄ promoters.js       # –ü—Ä–æ–º–æ—É—Ç–µ—Ä—ã
‚îÇ   ‚îú‚îÄ‚îÄ fights.js          # –ë–æ–∏
‚îÇ   ‚îú‚îÄ‚îÄ chatRoom.js        # –ß–∞—Ç –∫–æ–º–Ω–∞—Ç—ã
‚îÇ   ‚îú‚îÄ‚îÄ chatMessage.js     # –°–æ–æ–±—â–µ–Ω–∏—è —á–∞—Ç–∞
‚îÇ   ‚îú‚îÄ‚îÄ fightOffer.js      # –û—Ñ—Ñ–µ—Ä—ã –Ω–∞ –±–æ–∏
‚îÇ   ‚îú‚îÄ‚îÄ requisites_rf.js   # –†–µ–∫–≤–∏–∑–∏—Ç—ã –†–§
‚îÇ   ‚îú‚îÄ‚îÄ requisites_in.js   # –†–µ–∫–≤–∏–∑–∏—Ç—ã –º–µ–∂–¥—É–Ω–∞—Ä–æ–¥–Ω—ã–µ
‚îÇ   ‚îú‚îÄ‚îÄ passport_rf.js     # –ü–∞—Å–ø–æ—Ä—Ç –†–§
‚îÇ   ‚îú‚îÄ‚îÄ passport_in.js     # –ü–∞—Å–ø–æ—Ä—Ç –º–µ–∂–¥—É–Ω–∞—Ä–æ–¥–Ω—ã–π
‚îÇ   ‚îî‚îÄ‚îÄ ...                # –î—Ä—É–≥–∏–µ –º–æ–¥–µ–ª–∏
‚îú‚îÄ‚îÄ controller/            # –ö–æ–Ω—Ç—Ä–æ–ª–ª–µ—Ä—ã API
‚îÇ   ‚îú‚îÄ‚îÄ userController.js  # –ê—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è –∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏
‚îÇ   ‚îú‚îÄ‚îÄ fighterController/ # –ö–æ–Ω—Ç—Ä–æ–ª–ª–µ—Ä—ã –±–æ–π—Ü–æ–≤
‚îÇ   ‚îú‚îÄ‚îÄ promoterController/ # –ö–æ–Ω—Ç—Ä–æ–ª–ª–µ—Ä—ã –ø—Ä–æ–º–æ—É—Ç–µ—Ä–æ–≤
‚îÇ   ‚îú‚îÄ‚îÄ fightController.js  # –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –±–æ—è–º–∏
‚îÇ   ‚îú‚îÄ‚îÄ chatController.js  # –ß–∞—Ç —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç—å
‚îÇ   ‚îú‚îÄ‚îÄ fightResponseController.js # –û—Ç–∫–ª–∏–∫–∏ –Ω–∞ –±–æ–∏
‚îÇ   ‚îî‚îÄ‚îÄ pdfController.js   # –ì–µ–Ω–µ—Ä–∞—Ü–∏—è PDF
‚îú‚îÄ‚îÄ middleware/            # Middleware —Ñ—É–Ω–∫—Ü–∏–∏
‚îÇ   ‚îú‚îÄ‚îÄ authMiddleware.js  # –ü—Ä–æ–≤–µ—Ä–∫–∞ JWT —Ç–æ–∫–µ–Ω–æ–≤
‚îÇ   ‚îú‚îÄ‚îÄ fighterMiddleware.js # –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ä–æ–ª–∏ –±–æ–π—Ü–∞
‚îÇ   ‚îú‚îÄ‚îÄ promoMiddleware.js  # –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ä–æ–ª–∏ –ø—Ä–æ–º–æ—É—Ç–µ—Ä–∞
‚îÇ   ‚îî‚îÄ‚îÄ errorMiddleware.js  # –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫
‚îú‚îÄ‚îÄ router/               # –ú–∞—Ä—à—Ä—É—Ç—ã API
‚îÇ   ‚îú‚îÄ‚îÄ index.js          # –û—Å–Ω–æ–≤–Ω–æ–π —Ä–æ—É—Ç–µ—Ä
‚îÇ   ‚îú‚îÄ‚îÄ userRouter.js     # –†–æ—É—Ç—ã –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
‚îÇ   ‚îú‚îÄ‚îÄ fighterRouter.js  # –†–æ—É—Ç—ã –±–æ–π—Ü–æ–≤
‚îÇ   ‚îú‚îÄ‚îÄ promoterRouter.js # –†–æ—É—Ç—ã –ø—Ä–æ–º–æ—É—Ç–µ—Ä–æ–≤
‚îÇ   ‚îú‚îÄ‚îÄ fightRouter.js    # –†–æ—É—Ç—ã –±–æ–µ–≤
‚îÇ   ‚îú‚îÄ‚îÄ chatRouter.js     # –†–æ—É—Ç—ã —á–∞—Ç–æ–≤
‚îÇ   ‚îî‚îÄ‚îÄ pdfRouter.js      # –†–æ—É—Ç—ã PDF
‚îú‚îÄ‚îÄ services/             # –ë–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫–∞
‚îÇ   ‚îú‚îÄ‚îÄ tokenService.js   # –†–∞–±–æ—Ç–∞ —Å JWT —Ç–æ–∫–µ–Ω–∞–º–∏
‚îÇ   ‚îî‚îÄ‚îÄ ...               # –î—Ä—É–≥–∏–µ —Å–µ—Ä–≤–∏—Å—ã
‚îú‚îÄ‚îÄ utils/                # –£—Ç–∏–ª–∏—Ç—ã
‚îÇ   ‚îú‚îÄ‚îÄ pdfGenerator.js   # –ì–µ–Ω–µ—Ä–∞—Ç–æ—Ä PDF –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤
‚îÇ   ‚îî‚îÄ‚îÄ ...               # –î—Ä—É–≥–∏–µ —É—Ç–∏–ª–∏—Ç—ã
‚îî‚îÄ‚îÄ uploads/              # –ó–∞–≥—Ä—É–∂–µ–Ω–Ω—ã–µ —Ñ–∞–π–ª—ã
    ‚îú‚îÄ‚îÄ pdfs/             # PDF –¥–æ–∫—É–º–µ–Ω—Ç—ã
    ‚îî‚îÄ‚îÄ ...               # –î—Ä—É–≥–∏–µ —Ñ–∞–π–ª—ã
```

## üöÄ –ó–∞–ø—É—Å–∫ —Å–µ—Ä–≤–µ—Ä–∞

### –õ–æ–∫–∞–ª—å–Ω–∞—è —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∞

```bash
# –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π
npm install

# –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö –æ–∫—Ä—É–∂–µ–Ω–∏—è
cp ../env.example .env
# –û—Ç—Ä–µ–¥–∞–∫—Ç–∏—Ä—É–π—Ç–µ .env —Ñ–∞–π–ª

# –ó–∞–ø—É—Å–∫ –≤ —Ä–µ–∂–∏–º–µ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏
npm run dev
# –∏–ª–∏
nodemon index.js
```

### –ü—Ä–æ–¥–∞–∫—à–Ω

```bash
# –ó–∞–ø—É—Å–∫ —Å–µ—Ä–≤–µ—Ä–∞
node index.js

# –° –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–º–∏ –æ–∫—Ä—É–∂–µ–Ω–∏—è
NODE_ENV=production node index.js
```

## üîß –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è

### –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è (.env)

```env
# –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö
DB_HOST=localhost
DB_PORT=5432
DB_NAME=msma_db
DB_USER=your_username
DB_PASSWORD=your_password

# JWT —Å–µ–∫—Ä–µ—Ç—ã
ACCESS_SECRET=your_access_secret_key
REFRESH_SECRET=your_refresh_secret_key

# –°–µ—Ä–≤–µ—Ä
PORT=5000
NODE_ENV=development

# –ö–ª–∏–µ–Ω—Ç
CLIENT_URL=http://localhost:3000

# –ó–∞–≥—Ä—É–∑–∫–∏
UPLOAD_PATH=./uploads
```

## üì° API Endpoints

### –ê—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è

```
POST /api/user/register/step1     # –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è —à–∞–≥ 1 (email, password)
POST /api/user/register/step2     # –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è —à–∞–≥ 2 (–ª–∏—á–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ)
POST /api/user/register/step3     # –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è —à–∞–≥ 3 (—Ä–æ–ª—å)
POST /api/user/login             # –í—Ö–æ–¥ –≤ —Å–∏—Å—Ç–µ–º—É
POST /api/user/logout            # –í—ã—Ö–æ–¥ –∏–∑ —Å–∏—Å—Ç–µ–º—ã
POST /api/user/refresh           # –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Ç–æ–∫–µ–Ω–∞
GET  /api/user/check             # –ü—Ä–æ–≤–µ—Ä–∫–∞ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏
```

### –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏

```
GET  /api/user/profile           # –ü–æ–ª—É—á–µ–Ω–∏–µ –ø—Ä–æ—Ñ–∏–ª—è
PUT  /api/user/profile           # –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –ø—Ä–æ—Ñ–∏–ª—è
GET  /api/user/sessions          # –ê–∫—Ç–∏–≤–Ω—ã–µ —Å–µ—Å—Å–∏–∏
```

### –ë–æ–π—Ü—ã

```
GET  /api/fighter/profile/:id    # –ü—Ä–æ—Ñ–∏–ª—å –±–æ–π—Ü–∞
PUT  /api/fighter/profile/:id    # –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –ø—Ä–æ—Ñ–∏–ª—è
GET  /api/fighter/fights         # –ë–æ–∏ –±–æ–π—Ü–∞
POST /api/fighter/fight-response # –û—Ç–∫–ª–∏–∫ –Ω–∞ –±–æ–π
PUT  /api/fighter/requisitesrf/:id # –†–µ–∫–≤–∏–∑–∏—Ç—ã –†–§
PUT  /api/fighter/requisitesin/:id # –†–µ–∫–≤–∏–∑–∏—Ç—ã –º–µ–∂–¥—É–Ω–∞—Ä–æ–¥–Ω—ã–µ
PUT  /api/fighter/passportrf/:id   # –ü–∞—Å–ø–æ—Ä—Ç –†–§
PUT  /api/fighter/passportin/:id   # –ü–∞—Å–ø–æ—Ä—Ç –º–µ–∂–¥—É–Ω–∞—Ä–æ–¥–Ω—ã–π
```

### –ü—Ä–æ–º–æ—É—Ç–µ—Ä—ã

```
GET  /api/promoter/profile       # –ü—Ä–æ—Ñ–∏–ª—å –ø—Ä–æ–º–æ—É—Ç–µ—Ä–∞
GET  /api/promoter/fights        # –ë–æ–∏ –ø—Ä–æ–º–æ—É—Ç–µ—Ä–∞
POST /api/promoter/fight         # –°–æ–∑–¥–∞–Ω–∏–µ –±–æ—è
PUT  /api/promoter/fight/:id     # –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –±–æ—è
DELETE /api/promoter/fight/:id   # –£–¥–∞–ª–µ–Ω–∏–µ –±–æ—è
GET  /api/promoter/fighters      # –ü–æ–∏—Å–∫ –±–æ–π—Ü–æ–≤
POST /api/promoter/offer         # –û—Ç–ø—Ä–∞–≤–∫–∞ –æ—Ñ—Ñ–µ—Ä–∞
```

### –ë–æ–∏

```
GET  /api/fights                 # –°–ø–∏—Å–æ–∫ –≤—Å–µ—Ö –±–æ–µ–≤
GET  /api/fights/:id            # –î–µ—Ç–∞–ª–∏ –±–æ—è
POST /api/fights                 # –°–æ–∑–¥–∞–Ω–∏–µ –±–æ—è
PUT  /api/fights/:id            # –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –±–æ—è
DELETE /api/fights/:id          # –£–¥–∞–ª–µ–Ω–∏–µ –±–æ—è
```

### –ß–∞—Ç—ã

```
GET  /api/chat/rooms             # –°–ø–∏—Å–æ–∫ —á–∞—Ç –∫–æ–º–Ω–∞—Ç
GET  /api/chat/room/:id         # –î–µ—Ç–∞–ª–∏ –∫–æ–º–Ω–∞—Ç—ã
POST /api/chat/message          # –û—Ç–ø—Ä–∞–≤–∫–∞ —Å–æ–æ–±—â–µ–Ω–∏—è
GET  /api/chat/messages/:roomId # –ò—Å—Ç–æ—Ä–∏—è —Å–æ–æ–±—â–µ–Ω–∏–π
```

### PDF –¥–æ–∫—É–º–µ–Ω—Ç—ã

```
POST /api/pdf/fighter-offer      # –ì–µ–Ω–µ—Ä–∞—Ü–∏—è –æ—Ñ—Ñ–µ—Ä–∞ –±–æ–π—Ü–∞
POST /api/pdf/fight-contract     # –ì–µ–Ω–µ—Ä–∞—Ü–∏—è –∫–æ–Ω—Ç—Ä–∞–∫—Ç–∞
POST /api/pdf/offer-acceptance   # –ì–µ–Ω–µ—Ä–∞—Ü–∏—è –ø—Ä–∏–Ω—è—Ç–∏—è –æ—Ñ—Ñ–µ—Ä–∞
GET  /api/pdf/list              # –°–ø–∏—Å–æ–∫ PDF –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤
DELETE /api/pdf/:id             # –£–¥–∞–ª–µ–Ω–∏–µ PDF
```

## üîå WebSocket API

### –¢–∏–ø—ã —Å–æ–æ–±—â–µ–Ω–∏–π

```javascript
// –ê–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è
{
  "type": "auth",
  "userId": 123,
  "userType": "fighter" // –∏–ª–∏ "promoter"
}

// –ü—Ä–∏—Å–æ–µ–¥–∏–Ω–µ–Ω–∏–µ –∫ –∫–æ–º–Ω–∞—Ç–µ
{
  "type": "join_room",
  "roomId": 456
}

// –û—Ç–ø—Ä–∞–≤–∫–∞ —Å–æ–æ–±—â–µ–Ω–∏—è
{
  "type": "chat_message",
  "roomId": 456,
  "text": "–ü—Ä–∏–≤–µ—Ç!",
  "messageType": "text"
}

// –ò–Ω–¥–∏–∫–∞—Ç–æ—Ä –ø–µ—á–∞—Ç–∏
{
  "type": "typing",
  "roomId": 456,
  "isTyping": true
}

// –í—ã—Ö–æ–¥ –∏–∑ –∫–æ–º–Ω–∞—Ç—ã
{
  "type": "leave_room",
  "roomId": 456
}
```

### –û—Ç–≤–µ—Ç—ã —Å–µ—Ä–≤–µ—Ä–∞

```javascript
// –ò—Å—Ç–æ—Ä–∏—è —á–∞—Ç–∞
{
  "type": "chat_history",
  "roomId": 456,
  "messages": [...]
}

// –ù–æ–≤–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ
{
  "type": "new_message",
  "roomId": 456,
  "message": {...}
}

// –°—Ç–∞—Ç—É—Å –ø—Ä–æ—á—Ç–µ–Ω–∏—è
{
  "type": "messages_read",
  "data": {
    "messageIds": [1, 2, 3],
    "readAt": "2024-01-01T12:00:00Z",
    "readBy": 123
  }
}
```

## üóÑÔ∏è –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö

### –û—Å–Ω–æ–≤–Ω—ã–µ —Ç–∞–±–ª–∏—Ü—ã

- **users** - –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ —Å–∏—Å—Ç–µ–º—ã
- **fighters** - –±–æ–π—Ü—ã
- **promoters** - –ø—Ä–æ–º–æ—É—Ç–µ—Ä—ã
- **fights** - –±–æ–∏
- **chat_rooms** - —á–∞—Ç –∫–æ–º–Ω–∞—Ç—ã
- **chat_messages** - —Å–æ–æ–±—â–µ–Ω–∏—è
- **fight_offers** - –æ—Ñ—Ñ–µ—Ä—ã –Ω–∞ –±–æ–∏
- **requisites_rf** - —Ä–µ–∫–≤–∏–∑–∏—Ç—ã –†–§
- **requisites_in** - —Ä–µ–∫–≤–∏–∑–∏—Ç—ã –º–µ–∂–¥—É–Ω–∞—Ä–æ–¥–Ω—ã–µ
- **passport_rf** - –ø–∞—Å–ø–æ—Ä—Ç –†–§
- **passport_in** - –ø–∞—Å–ø–æ—Ä—Ç –º–µ–∂–¥—É–Ω–∞—Ä–æ–¥–Ω—ã–π

### –ú–∏–≥—Ä–∞—Ü–∏–∏

```bash
# –°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è –º–æ–¥–µ–ª–µ–π —Å –ë–î
npx sequelize-cli db:migrate

# –û—Ç–∫–∞—Ç –º–∏–≥—Ä–∞—Ü–∏–π
npx sequelize-cli db:migrate:undo
```

## üîê –ê—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è

### JWT —Ç–æ–∫–µ–Ω—ã

- **Access Token** - –¥–ª—è –¥–æ—Å—Ç—É–ø–∞ –∫ API (–∫–æ—Ä–æ—Ç–∫–∏–π —Å—Ä–æ–∫)
- **Refresh Token** - –¥–ª—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è access token (–¥–æ–ª–≥–∏–π —Å—Ä–æ–∫)

### Middleware

- `authMiddleware` - –ø—Ä–æ–≤–µ—Ä–∫–∞ access token
- `fighterMiddleware` - –ø—Ä–æ–≤–µ—Ä–∫–∞ —Ä–æ–ª–∏ –±–æ–π—Ü–∞
- `promoMiddleware` - –ø—Ä–æ–≤–µ—Ä–∫–∞ —Ä–æ–ª–∏ –ø—Ä–æ–º–æ—É—Ç–µ—Ä–∞

## üìÑ –ì–µ–Ω–µ—Ä–∞—Ü–∏—è PDF

### –ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ–º—ã–µ –¥–æ–∫—É–º–µ–Ω—Ç—ã

- –û—Ñ—Ñ–µ—Ä—ã –¥–ª—è –±–æ–π—Ü–æ–≤
- –ö–æ–Ω—Ç—Ä–∞–∫—Ç—ã –Ω–∞ –±–æ–∏
- –î–æ–∫—É–º–µ–Ω—Ç—ã –æ –ø—Ä–∏–Ω—è—Ç–∏–∏ –æ—Ñ—Ñ–µ—Ä–æ–≤

### –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ

```javascript
const pdfGenerator = require('./utils/pdfGenerator');

// –ì–µ–Ω–µ—Ä–∞—Ü–∏—è –æ—Ñ—Ñ–µ—Ä–∞
const result = await pdfGenerator.generateFighterOfferPDF(fighterData, offerData);
```

## üö® –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫

### –°—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–µ HTTP –∫–æ–¥—ã

- `200` - –£—Å–ø–µ—à–Ω—ã–π –∑–∞–ø—Ä–æ—Å
- `201` - –†–µ—Å—É—Ä—Å —Å–æ–∑–¥–∞–Ω
- `400` - –ù–µ–≤–µ—Ä–Ω—ã–π –∑–∞–ø—Ä–æ—Å
- `401` - –ù–µ –∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω
- `403` - –î–æ—Å—Ç—É–ø –∑–∞–ø—Ä–µ—â–µ–Ω
- `404` - –ù–µ –Ω–∞–π–¥–µ–Ω–æ
- `500` - –í–Ω—É—Ç—Ä–µ–Ω–Ω—è—è –æ—à–∏–±–∫–∞ —Å–µ—Ä–≤–µ—Ä–∞

### –§–æ—Ä–º–∞—Ç –æ—à–∏–±–∫–∏

```json
{
  "message": "–û–ø–∏—Å–∞–Ω–∏–µ –æ—à–∏–±–∫–∏",
  "code": "ERROR_CODE",
  "details": {}
}
```

## üìä –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ

### –£—Ä–æ–≤–Ω–∏ –ª–æ–≥–æ–≤

- `error` - –ö—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ –æ—à–∏–±–∫–∏
- `warn` - –ü—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏—è
- `info` - –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏–æ–Ω–Ω—ã–µ —Å–æ–æ–±—â–µ–Ω–∏—è
- `debug` - –û—Ç–ª–∞–¥–æ—á–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è

### –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –ª–æ–≥–æ–≤

```javascript
// –í index.js
const winston = require('winston');
const logger = winston.createLogger({
  level: 'info',
  format: winston.format.json(),
  transports: [
    new winston.transports.File({ filename: 'error.log', level: 'error' }),
    new winston.transports.File({ filename: 'combined.log' })
  ]
});
```

## üîß –†–∞–∑—Ä–∞–±–æ—Ç–∫–∞

### –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –Ω–æ–≤–æ–≥–æ API endpoint

1. –°–æ–∑–¥–∞–π—Ç–µ –∫–æ–Ω—Ç—Ä–æ–ª–ª–µ—Ä –≤ `controller/`
2. –î–æ–±–∞–≤—å—Ç–µ —Ä–æ—É—Ç –≤ `router/`
3. –ü–æ–¥–∫–ª—é—á–∏—Ç–µ —Ä–æ—É—Ç –≤ `router/index.js`
4. –î–æ–±–∞–≤—å—Ç–µ –≤–∞–ª–∏–¥–∞—Ü–∏—é —Å Joi
5. –ù–∞–ø–∏—à–∏—Ç–µ —Ç–µ—Å—Ç—ã

### –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –Ω–æ–≤–æ–π –º–æ–¥–µ–ª–∏

1. –°–æ–∑–¥–∞–π—Ç–µ –º–æ–¥–µ–ª—å –≤ `models/`
2. –î–æ–±–∞–≤—å—Ç–µ –∞—Å—Å–æ—Ü–∏–∞—Ü–∏–∏ –≤ `models/index.js`
3. –°–æ–∑–¥–∞–π—Ç–µ –º–∏–≥—Ä–∞—Ü–∏—é
4. –î–æ–±–∞–≤—å—Ç–µ –∫–æ–Ω—Ç—Ä–æ–ª–ª–µ—Ä—ã –∏ —Ä–æ—É—Ç—ã

### –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –∫–æ–Ω—Ç—Ä–æ–ª–ª–µ—Ä–∞

```javascript
class ExampleController {
  async methodName(req, res) {
    try {
      // –í–∞–ª–∏–¥–∞—Ü–∏—è
      const { error } = schema.validate(req.body);
      if (error) {
        return res.status(400).json({ message: error.details[0].message });
      }

      // –ë–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫–∞
      const result = await someService(req.body);

      // –û—Ç–≤–µ—Ç
      res.json(result);
    } catch (err) {
      console.error('–û—à–∏–±–∫–∞:', err);
      res.status(500).json({ message: '–í–Ω—É—Ç—Ä–µ–Ω–Ω—è—è –æ—à–∏–±–∫–∞ —Å–µ—Ä–≤–µ—Ä–∞' });
    }
  }
}
```

## üß™ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

### –ó–∞–ø—É—Å–∫ —Ç–µ—Å—Ç–æ–≤

```bash
# –í—Å–µ —Ç–µ—Å—Ç—ã
npm test

# –ö–æ–Ω–∫—Ä–µ—Ç–Ω—ã–π —Ç–µ—Å—Ç
npm test -- --grep "test name"

# –ü–æ–∫—Ä—ã—Ç–∏–µ –∫–æ–¥–∞
npm run test:coverage
```

### –°—Ç—Ä—É–∫—Ç—É—Ä–∞ —Ç–µ—Å—Ç–æ–≤

```
tests/
‚îú‚îÄ‚îÄ unit/           # –ú–æ–¥—É–ª—å–Ω—ã–µ —Ç–µ—Å—Ç—ã
‚îú‚îÄ‚îÄ integration/    # –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏–æ–Ω–Ω—ã–µ —Ç–µ—Å—Ç—ã
‚îî‚îÄ‚îÄ fixtures/       # –¢–µ—Å—Ç–æ–≤—ã–µ –¥–∞–Ω–Ω—ã–µ
```

## üìà –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥

### –ú–µ—Ç—Ä–∏–∫–∏

- –í—Ä–µ–º—è –æ—Ç–≤–µ—Ç–∞ API
- –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –∑–∞–ø—Ä–æ—Å–æ–≤
- –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –ø–∞–º—è—Ç–∏
- –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ WebSocket —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–π

### Health check

```
GET /api/health
```

–û—Ç–≤–µ—Ç:
```json
{
  "status": "ok",
  "timestamp": "2024-01-01T12:00:00Z",
  "uptime": 3600,
  "database": "connected",
  "websocket": "active"
}
```

## üîí –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å

### –ú–µ—Ä—ã –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏

- –í–∞–ª–∏–¥–∞—Ü–∏—è –≤—Å–µ—Ö –≤—Ö–æ–¥–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö
- –ó–∞—â–∏—Ç–∞ –æ—Ç SQL –∏–Ω—ä–µ–∫—Ü–∏–π (Sequelize)
- Rate limiting
- CORS –Ω–∞—Å—Ç—Ä–æ–π–∫–∏
- HTTPS –≤ –ø—Ä–æ–¥–∞–∫—à–µ–Ω–µ
- –ë–µ–∑–æ–ø–∞—Å–Ω—ã–µ –∑–∞–≥–æ–ª–æ–≤–∫–∏

### Rate Limiting

```javascript
const rateLimit = require('express-rate-limit');

const limiter = rateLimit({
  windowMs: 15 * 60 * 1000, // 15 –º–∏–Ω—É—Ç
  max: 100 // –º–∞–∫—Å–∏–º—É–º 100 –∑–∞–ø—Ä–æ—Å–æ–≤ —Å –æ–¥–Ω–æ–≥–æ IP
});

app.use('/api/', limiter);
```

## üìû –ü–æ–¥–¥–µ—Ä–∂–∫–∞

–ü—Ä–∏ –≤–æ–∑–Ω–∏–∫–Ω–æ–≤–µ–Ω–∏–∏ –ø—Ä–æ–±–ª–µ–º:

1. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏ —Å–µ—Ä–≤–µ—Ä–∞
2. –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ –±–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö –¥–æ—Å—Ç—É–ø–Ω–∞
3. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è
4. –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ –≤—Å–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω—ã

### –ü–æ–ª–µ–∑–Ω—ã–µ –∫–æ–º–∞–Ω–¥—ã

```bash
# –ü—Ä–æ—Å–º–æ—Ç—Ä –ª–æ–≥–æ–≤
tail -f logs/app.log

# –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—Ç–∞—Ç—É—Å–∞ –ë–î
psql -h localhost -U msma_user -d msma_db -c "\dt"

# –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ—Ä—Ç–æ–≤
netstat -tlnp | grep :5000

# –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –ø—Ä–æ—Ü–µ—Å—Å–æ–≤
htop
```

## üìù –õ–∏—Ü–µ–Ω–∑–∏—è

MIT License
